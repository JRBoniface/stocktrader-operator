#       Copyright 2017-2021 IBM Corp, All Rights Reserved
#       Copyright 2022-2025 Kyndryl, All Rights Reserved

#   Licensed under the Apache License, Version 2.0 (the "License");
#   you may not use this file except in compliance with the License.
#   You may obtain a copy of the License at

#       http://www.apache.org/licenses/LICENSE-2.0

#   Unless required by applicable law or agreed to in writing, software
#   distributed under the License is distributed on an "AS IS" BASIS,
#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#   See the License for the specific language governing permissions and
#   limitations under the License.

# Default values for stocktrader.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.
global:
  auth: basic
  monitoring: true
  ingress: false
  route: false
  healthCheck: true
  disableLogFiles: false
  jsonLogging: false
  traceSpec: "*=info"
  cqrs: false
  istio: false
  istioNamespace: istio-system
  istioIngress: ingressgateway
  istioEgress: egressgateway
  externalConfigMap: false
  configMapName: "{{ .Release.Name }}-config"
  externalSecret: false
  secretName: "{{ .Release.Name }}-credentials"
  proxyServer: false
  proxyServerAddress: <your proxy URL>
  pullSecret: false
  pullSecretName: <your pull secret>
  specifyCerts: false
  certs: <your SSL certificates>
database:
  # Type of database deployment: internal (managed by chart) or external (pre-existing)  
  type: internal
  kind: postgresql
  external:
    host: db2inst1
    port: 50000
    id: db2inst1
    password: db2inst1
    db: trader
    ssl: false
broker:
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/broker
    tag: 1.0.0
  url: http://{{ .Release.Name }}-broker-service:9080/broker
portfolio:
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/portfolio
    tag: 1.0.0
  url: http://{{ .Release.Name }}-portfolio-service:9080/portfolio
stockQuote:
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/stock-quote
    tag: 1.0.0
  url: http://{{ .Release.Name }}-stock-quote-service:9080/stock-quote
  apiConnect: https://api.us.apiconnect.ibmcloud.com/jalcornusibmcom-dev/sb/stocks
  iexTrading: https://cloud.iexapis.com/stable/stock
  iexApiKey: <your IEX API key>
  encryption:
    class: noneEncryptor
    saltBytes: <salt bytes generated>
    password: <encryption password>
trader:
  enabled: true
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/trader
    tag: 1.0.0
  whiteLabelHeaderImage: header.jpg
  whiteLabelFooterImage: footer.jpg
  whiteLabelLoginMessage: Log in to Stock Trader
tradr:
  enabled: false
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/tradr
    tag: 1.0.0
cashAccount:
  enabled: false
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/cash-account
    tag: 1.0.0
  url: http://{{ .Release.Name }}-cash-account-service:8080/cash-account
  exchangeRateUrl: https://api.frankfurter.app/latest
account:
  enabled: false
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/account
    tag: 1.0.0
  url: http://{{ .Release.Name }}-account-service:9080/account
messaging:
  enabled: false
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/messaging
    tag: 1.0.0
  notification:
    url: http://{{ .Release.Name }}-notification-service:9080/notification
notificationSlack:
  enabled: false
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/notification-slack
    tag: 1.0.0
notificationTwitter:
  enabled: false
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/notification-twitter
    tag: 1.0.0
tradeHistory:
  enabled: false
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/trade-history
    tag: 1.0.0
  url: http://{{ .Release.Name }}-trade-history-service:9080/trade-history
looper:
  enabled: false
  replicas: 1
  autoscale: false
  maxReplicas: 10
  cpuThreshold: 75
  image:
    repository: ghcr.io/ibmstocktrader/looper
    tag: 1.0.0
  url: http://{{ .Release.Name }}-looper-service:9080/looper
jwt:
  issuer: http://stock-trader.ibm.com
  audience: stock-trader
oidc:
  clientId: <your client id>
  clientSecret: <your client secret>
  discoveryUrl: <your discovery endpoint URL>
  jwksUrl: <your JSON web key set url>
ldap:
  host: bluepages.ibm.com
  port: 389
  baseDN: o=ibm.com
  realm: BluePages
vault:
  enabled: false
  path: <path to Vault secrets>
  role: <Vault auth role>
  jwtPath: /var/run/secrets/kubernetes.io/serviceaccount
watson:
  id: apikey
  passwordOrApiKey: <your API key>
  url: https://gateway.watsonplatform.net/tone-analyzer/api/v3/tone?version=2017-09-21&sentences=false
odm:
  id: odmAdmin
  password: odmAdmin
  url: http://odmtrader1-ibm-odm-dev:9060/DecisionService/rest/ICP_Trader_Dev_1/determineLoyalty
mq:
  kind: ibm-mq
  host: mqtrader1-mqtrader1
  port: 1414
  id: app
  password: ""
  queueManager: stocktrader
  queue: NotificationQ
  channel: DEV.APP.SVRCONN
  url: <your mq url>
redis:
  # Type of Redis deployment: internal (managed by chart) or external (pre-existing)  
  type: internal
  enabled: true
  # Bitnami Redis subchart configuration
  # https://github.com/bitnami/charts/tree/main/bitnami/redis
  architecture: standalone
  image:
    registry: docker.io
    # Bitnami Redis legacy image repository used for Redis 7
    # https://community.broadcom.com/blogs/beltran-rueda-borrego/2025/08/18/how-to-prepare-for-the-bitnami-changes-coming-soon
    repository: bitnamilegacy/redis
    tag: "8.2.1-debian-12-r0"
    pullPolicy: IfNotPresent
  auth:
    enabled: true
    password: changeme
    existingSecret: ""
    existingSecretPasswordKey: redis-password
  master:
    service:
      ports:
        redis: 6379
    persistence:
      enabled: true
      size: 1Gi
    resources:
      limits:
        cpu: 250m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi
  replica:
    replicaCount: 0  # Set to 0 for standalone, increase for master-replica setup
  metrics:
    enabled: false
  networkPolicy:
    enabled: false
  cacheInterval: 60
  # Configuration for external Redis instance
  external:
    enabled: false
    # NOTE: Usually this is defined granularly instead of a full URL
    urlWithCredentials: redis://<your credentials>@<your redis host>:6379
openwhisk:
  id: <your id>
  password: <your password>
  url: https://openwhisk.ng.bluemix.net/api/v1/namespaces/jalcorn%40us.ibm.com_dev/actions/PostLoyaltyLevelToSlack
twitter:
  consumerKey: <your consumer key>
  consumerSecret: <your consumer secret>
  accessToken: <your access token>
  accessTokenSecret: <your access token secret>
kafka:
  enabled: false
  kind: ibm-event-streams
  address: <your Kafka proxy service>:30000
  brokerTopic: broker
  portfolioTopic: portfolio
  accountTopic: account
  cashAccountTopic: cash-account
  saslMechanism: PLAIN
  saslConfig: <your sasl jaas config>
  historyTopic: history
  user: token
  apiKey: <your API key>
  # Bitnami Kafka subchart configuration
  # https://github.com/bitnami/charts/tree/main/bitnami/kafka
  listeners:
    client:
      protocol: PLAINTEXT
  controller:
    replicaCount: 1
  persistence:
    enabled: true
    size: 2Gi
cloudant:
  url: <your Cloudant URL>
  host: <your Cloudant Hostname/IP>
  port: <your Cloudant port>
  id: <your Cloudant ID>
  password: <your Cloudant Password>
  database: <your Cloudant Account database name>
mongo:
  enabled: false
  ip: <your Mongo IP>
  port: 27017
  user: <your Mongo user>
  password: <your Mongo password>
  database: <your Mongo database>
  connectionString: <your Mongo connection string>
  authDB: <your Mongo auth database>

# MongoDB subchart configuration (for trade history feature)
# https://github.com/bitnami/charts/tree/main/bitnami/mongodb
mongodb:
  enabled: true
  auth:
    enabled: true
    rootPassword: changeme
    username: stocktrader
    password: changeme
    database: tradehistory
  service:
    ports:
      mongodb: 27017
  persistence:
    enabled: true
    size: 2Gi
s3:
  enabled: false
  bucket: stock-trader
  location: <your S3 location>
  endpointUrl: <your S3 endpoint URL>
  resourceInstanceId: <your S3 CRN>
  apiKey: <your S3 API Key>

# PostgreSQL subchart configuration
# https://github.com/bitnami/charts/tree/main/bitnami/postgresql
postgresql:
  enabled: true
  auth:
    username: stocktrader
    password: changeme
    database: trader
  primary:
    containerPorts:
      postgresql: 5432
    service:
      ports:
        postgresql: 5432
    persistence:
      enabled: true
      size: 2Gi
    initdb:
      scripts:
        create-schema-and-tables.sql: |
          -- Stock Trader Database Schema-
          CREATE TABLE IF NOT EXISTS Portfolio(
            owner VARCHAR(32) NOT NULL, 
            total DOUBLE PRECISION, 
            accountID VARCHAR(64), 
            PRIMARY KEY(owner)
          );
          
          CREATE TABLE IF NOT EXISTS Stock(
            owner VARCHAR(32) NOT NULL, 
            symbol VARCHAR(8) NOT NULL, 
            shares INTEGER, 
            price DOUBLE PRECISION, 
            total DOUBLE PRECISION, 
            dateQuoted VARCHAR(10), 
            commission DOUBLE PRECISION, 
            FOREIGN KEY (owner) REFERENCES Portfolio(owner) ON DELETE CASCADE, 
            PRIMARY KEY(owner, symbol)
          );
          
          CREATE TABLE IF NOT EXISTS cashaccount(
            owner VARCHAR(32) NOT NULL, 
            balance DOUBLE PRECISION, 
            currency VARCHAR(8), 
            PRIMARY KEY(owner)
          );
          
          -- Add currency constraint if it doesn't exist
          DO $$
          BEGIN
            IF NOT EXISTS (
              SELECT 1 FROM pg_constraint WHERE conname = 'allowed_currencies'
            ) THEN
              ALTER TABLE cashaccount ADD CONSTRAINT allowed_currencies 
              CHECK (currency IN (
                'AUD', 'BGN', 'BRL', 'CAD', 'CHF', 'CNY', 'CZK', 'DKK', 
                'EUR', 'GBP', 'HKD', 'HUF', 'IDR', 'ILS', 'INR', 'ISK', 
                'JPY', 'KRW', 'MXN', 'MYR', 'NOK', 'NZD', 'PHP', 'PLN', 
                'RON', 'SEK', 'SGD', 'THB', 'TRY', 'USD', 'ZAR'
              ));
            END IF;
          END$$; 
